CREATE TABLE "public"."piezareal" (
  "idpiezareal" BIGSERIAL, 
  "idpieza" BIGINT NOT NULL, 
  "estado" BIGINT, 
  "nropieza" INTEGER, 
  "idcodigobarra" BIGINT, 
  CONSTRAINT "piezareal_idpiezareal_key" UNIQUE("idpiezareal"), 
  CONSTRAINT "piezareal_pkey" PRIMARY KEY("idpiezareal", "idpieza"), 
  CONSTRAINT "piezareal_fk" FOREIGN KEY ("idpieza")
    REFERENCES "public"."pieza"("idpieza")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION
    NOT DEFERRABLE, 
  CONSTRAINT "piezareal_fk1" FOREIGN KEY ("estado")
    REFERENCES "public"."estadopiezareal"("idestado")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION
    NOT DEFERRABLE, 
  CONSTRAINT "piezareal_fk2" FOREIGN KEY ("idcodigobarra")
    REFERENCES "public"."codigodebarra"("idcodigo")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION
    NOT DEFERRABLE
) WITH OIDS;





CREATE OR REPLACE VIEW "public"."viewpedidosclientesegunestado" (
    nropedido,
    nropedidocotizacioncliente,
    fechapedidocotizacion,
    fecharequeridacotizacion,
    fechaentregaestipulada,
    espedidoweb,
    estado,
    prioridad,
    cliente,
    idpedido,
    idestado,
    idcliente,
    nrocliente)
AS
 SELECT p.nropedido,
       p.nropedidocotizacioncliente,
       p.fechapedidocotizacion,
       p.fecharequeridacotizacion,
       p.fechaentregaestipulada,
       p.espedidoweb,
       ep.nombre AS estado,
       pr.nombre AS prioridad,
       c.razonsocial AS cliente,
       p.idpedido,
       ep.idestado,
       c.idcliente,
       c.nrocliente
 FROM pedido p,
      cliente c,
      estadopedido ep,
      prioridad pr
 WHERE p.cliente = c.idcliente AND
       p.estado = ep.idestado AND
       p.prioridad = pr.idprioridad
 ORDER BY p.nropedido;